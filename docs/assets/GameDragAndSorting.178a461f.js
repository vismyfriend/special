import{S as g}from"./sortable.esm.65a421f9.js";import{u as k,p as S,o,f as c,h as e,t as l,F as m,q as h,n as f,z as b}from"./index.b9c5d06d.js";import{s as _}from"./sortingWordsData.0ee8ba95.js";import{u as p}from"./example-store.a1a726c2.js";import{_ as v}from"./plugin-vue_export-helper.21dcd24c.js";const C={name:"GameDragAndSorting",setup(){const t=k(),s=S(),i=p();return{route:t,router:s,gameStore:i}},data(){return{sortableInstances:[],currentGameData:{title:"",instructions:"",columns:[],items:[]},currentWords:[],columnAssignments:{},completedItems:new Set,columnRefs:{},startTime:null,mistakes:0,wordStatus:{},checkTimer:null,isDragging:!1}},computed:{availableWords(){return this.currentWords.filter(t=>!this.columnAssignments[t.id])}},mounted(){this.initializeGame()},methods:{initializeGame(){const t=this.route.params.missionName||"fruitsVegetables";this.currentGameData=_[t]||_.fruitsVegetables,this.currentWords=[...this.currentGameData.items],this.columnAssignments={},this.completedItems=new Set,this.columnRefs={},this.wordStatus={},this.startTime=Date.now(),this.mistakes=0,this.isDragging=!1,this.checkTimer&&clearInterval(this.checkTimer),this.$nextTick(()=>{this.initializeSortable(),this.startPeriodicCheck()})},initializeSortable(){this.sortableInstances.forEach(s=>s.destroy()),this.sortableInstances=[];const t={group:{name:"words",pull:!0,put:!0},animation:180,ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",forceFallback:!0,fallbackOnBody:!0,fallbackTolerance:5,fallbackOffset:{x:0,y:-8},delay:0,delayOnTouchOnly:!1,onStart:()=>{this.isDragging=!0},onEnd:()=>{this.isDragging=!1}};if(this.$refs.wordsContainer){const s=new g(this.$refs.wordsContainer,{...t,sort:!1,onAdd:i=>{const u=i.item.getAttribute("data-id");delete this.columnAssignments[u],this.wordStatus[u]=null}});this.sortableInstances.push(s)}this.currentGameData.columns.forEach(s=>{const i=this.columnRefs[s.id];if(i){const u=new g(i,{...t,onAdd:d=>{const a=d.item.getAttribute("data-id");this.columnAssignments[a]=s.id}});this.sortableInstances.push(u)}})},startPeriodicCheck(){this.checkTimer=setInterval(()=>{this.isDragging||this.checkWordStatuses()},500)},checkWordStatuses(){this.currentWords.forEach(t=>{if(this.columnAssignments[t.id]){const i=this.columnAssignments[t.id]===t.correctColumn;(this.wordStatus[t.id]===null||i&&this.wordStatus[t.id]!=="correct"||!i&&this.wordStatus[t.id]!=="incorrect")&&(this.wordStatus[t.id]=i?"correct":"incorrect",i||this.mistakes++)}else this.wordStatus[t.id]=null})},getWordCardClass(t){const s=this.wordStatus[t];return s==="correct"?"word-correct":s==="incorrect"?"word-incorrect":""},getItemsInColumn(t){return this.currentWords.filter(s=>this.columnAssignments[s.id]===t)},checkAnswers(){this.checkTimer&&clearInterval(this.checkTimer);let t=0;this.currentWords.forEach(s=>{this.columnAssignments[s.id]===s.correctColumn?(this.completedItems.add(s.id),this.wordStatus[s.id]="correct"):this.columnAssignments[s.id]&&(t++,this.wordStatus[s.id]="incorrect")}),t>0&&(this.mistakes+=t),this.finishGame()},finishGame(){const t=Date.now()-this.startTime;this.gameStore.setLastGameResults(t,this.mistakes),this.gameStore.setGameName("WordSorting"),this.gameStore.setWordSet(this.route.params.missionName),this.router.push({path:"/leader-board/",query:{missionName:this.route.params.missionName}})},resetGame(){this.initializeGame()}},beforeUnmount(){this.sortableInstances.forEach(t=>t.destroy()),this.checkTimer&&clearInterval(this.checkTimer)}},w={class:"drag-sort-game"},G={class:"game-header"},A={class:"instructions"},I={ref:"wordsContainer",class:"words-container"},D=["data-id"],W={class:"word-eng"},T={class:"word-ru"},y={class:"columns-container"},E={class:"column-header"},N=["data-id"],x={class:"word-eng"},z={class:"word-ru"},R={class:"game-controls"};function O(t,s,i,u,d,a){return o(),c("div",w,[e("div",G,[e("h2",null,l(d.currentGameData.title),1)]),e("div",A,[e("p",null,l(d.currentGameData.instructions),1)]),e("div",I,[(o(!0),c(m,null,h(a.availableWords,r=>(o(),c("div",{key:r.id,class:f(["word-card",a.getWordCardClass(r.id)]),"data-id":r.id},[e("div",W,l(r.eng),1),e("div",T,l(r.ru),1)],10,D))),128))],512),e("div",y,[(o(!0),c(m,null,h(d.currentGameData.columns,r=>(o(),c("div",{key:r.id,class:"column"},[e("div",E,[s[2]||(s[2]=e("span",{class:"column-icon"},"\u{1F4C1}",-1)),b(" "+l(r.title),1)]),e("div",{ref_for:!0,ref:n=>{d.columnRefs[r.id]=n},class:"column-content"},[(o(!0),c(m,null,h(a.getItemsInColumn(r.id),n=>(o(),c("div",{key:n.id,class:f(["word-card in-column",a.getWordCardClass(n.id)]),"data-id":n.id},[e("div",x,l(n.eng),1),e("div",z,l(n.ru),1)],10,N))),128))],512)]))),128))]),e("div",R,[e("button",{onClick:s[0]||(s[0]=(...r)=>a.checkAnswers&&a.checkAnswers(...r)),class:"control-button check"}," \u2705 \u041F\u0440\u043E\u0432\u0435\u0440\u0438\u0442\u044C \u043E\u0442\u0432\u0435\u0442\u044B "),e("button",{onClick:s[1]||(s[1]=(...r)=>a.resetGame&&a.resetGame(...r)),class:"control-button reset"}," \u{1F504} \u041D\u0430\u0447\u0430\u0442\u044C \u0437\u0430\u043D\u043E\u0432\u043E ")])])}var P=v(C,[["render",O],["__scopeId","data-v-fe09839e"]]);export{P as default};
