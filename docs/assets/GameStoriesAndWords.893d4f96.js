import{u as P,r as g,o as z,b as l,c as i,e as r,t as p,F as h,q as S,s as K,l as m,j as V,m as G,n as D,B as U,z as M,C as O}from"./index.9754ccc1.js";import{s as q}from"./storiesData.b350cfa0.js";import{_ as R}from"./plugin-vue_export-helper.21dcd24c.js";const j={key:0,class:"stories-container"},H={class:"stories-header"},J={class:"header-bottom"},Q={class:"task-counter"},X={key:0,class:"useful-words-container"},Y={class:"useful-words"},Z={class:"useful-words-content"},ee={class:"english-word"},te={class:"translation"},se={key:0,class:"comma"},oe={class:"story-title"},re={key:1,class:"story-image-container"},ae=["src","alt"],ne={key:2,controls:"",class:"audio-player",controlsList:"nodownload",oncontextmenu:"return false;"},le=["src"],ie={class:"story-text"},ue=["onUpdate:modelValue","onKeyup","data-story","data-gap"],ce={key:3,class:"text-script-content"},de={class:"story-footer"},pe={class:"story-controls"},ve=["onClick"],fe=["onClick"],ge={class:"story-navigation"},_e=["disabled"],he=["disabled"],me={key:1,class:"loading-container"},ye={__name:"GameStoriesAndWords",setup(ke){const N=P(),c=g(null),v=g([]),_=g([]),b=g(null),y=g([]),f=g(0),A=g([]);z(()=>{const e=N.params.missionName;c.value=q[e]||null,c.value&&(v.value=c.value.listOfStories.map(n=>{const s=C(n.text).flat().filter(t=>t.type==="gap").length;return Array(s).fill("")}),_.value=c.value.listOfStories.map(()=>!1),y.value=c.value.listOfStories.map(()=>null)),$()});const k=e=>!e||typeof e!="string"?"":e.toLowerCase().replace(/\s+/g," ").trim().replace(/[.,!?;:…–—]+$/g,"").replace(/[.,!?;:…–—]/g," ").replace(/\s+/g," ").replace(/^-$/,""),C=e=>{if(!e)return[];const n=e.split(`
`).filter(o=>o.trim()!=="");let s=0;const t=[];for(const o of n){const u=[];let a=0,d;const w=/(_+) \((.+?)\)/g;for(;(d=w.exec(o))!==null;)d.index>a&&u.push({type:"text",text:o.substring(a,d.index)}),u.push({type:"gap",gapIndex:s++,gapLength:d[1].length,correctAnswer:d[2]}),a=d.index+d[0].length;a<o.length&&u.push({type:"text",text:o.substring(a)}),u.length>0&&t.push(u)}return t},T=e=>{const n=c.value.listOfStories[e];_.value[e]=!0;let s=0;const t=C(n.text).flat().filter(o=>o.type==="gap");t.forEach((o,u)=>{const a=k(v.value[e][u]),d=k(o.correctAnswer);o.correctAnswer.trim()==="-"?(a===""||k(v.value[e][u])==="-")&&s++:(o.correctAnswer.toLowerCase()==="anyanswerisok"||a===d)&&s++}),y.value[e]=Math.round(s/t.length*100)},F=(e,n,s)=>{if(!_.value[e])return"";const t=k(v.value[e][n]),o=k(s);return s.trim()==="-"?t===""||v.value[e][n]==="-"?"story-input-correct":"story-input-incorrect":s.toLowerCase()==="anyanswerisok"?"story-input-any":t===o?"story-input-correct":"story-input-incorrect"},I=()=>{f.value<c.value.listOfStories.length-1&&(f.value++,window.scrollTo({top:0,behavior:"smooth"}))},W=()=>{f.value>0&&(f.value--,window.scrollTo({top:0,behavior:"smooth"}))},x=e=>e===100?{letter:"A+",class:"grade-Aplus"}:e>=85?{letter:"A",class:"grade-A"}:e>=75?{letter:"B+",class:"grade-Bplus"}:e>=60?{letter:"B-",class:"grade-Bminus"}:e>=40?{letter:"C",class:"grade-C"}:e>=20?{letter:"D",class:"grade-D"}:e>=10?{letter:"E",class:"grade-E"}:{letter:"F",class:"grade-F"},B=e=>{b.value=b.value===e?null:e},L=e=>e?e.split(",").map(n=>{const[s,t]=n.split("-").map(o=>o.trim());return{english:s,russian:t}}):[],E=(e,n)=>{const s=n+1;s<v.value[e].length?O(()=>{const t=A.value.find(o=>Number(o.dataset.story)===e&&Number(o.dataset.gap)===s);t&&(t.focus(),t.select())}):O(()=>{const t=document.querySelector('.story-container[style*="block"] .check-button');t==null||t.focus()})},$=()=>{document.addEventListener("contextmenu",e=>{if(e.target.classList.contains("audio-player"))return e.preventDefault(),!1}),document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="s"&&e.preventDefault()})};return(e,n)=>c.value?(l(),i("div",j,[r("div",H,[r("h2",null,p(c.value.mainDescription),1),r("div",J,[n[0]||(n[0]=r("p",{class:"main-description"},"for S.P.E.C.i.A.L. agents",-1)),r("div",Q,p(f.value+1)+"/"+p(c.value.listOfStories.length),1)])]),(l(!0),i(h,null,S(c.value.listOfStories,(s,t)=>(l(),i("div",{key:t,class:"story-container",style:K({display:t===f.value?"block":"none"})},[s.usefulWords?(l(),i("div",X,[r("div",Y,[n[2]||(n[2]=r("span",{class:"useful-words-title"},"Useful words:",-1)),r("div",Z,[(l(!0),i(h,null,S(L(s.usefulWords),(o,u)=>(l(),i("div",{key:u,class:"word-pair"},[r("span",ee,p(o.english),1),n[1]||(n[1]=r("span",{class:"separator"},"-",-1)),r("span",te,p(o.russian),1),u<L(s.usefulWords).length-1?(l(),i("span",se,",")):m("",!0)]))),128))])])])):m("",!0),r("h3",oe,p(s.storyTitle),1),s.taskPicture?(l(),i("div",re,[r("img",{src:s.taskPicture,alt:"Image for story "+(t+1),class:"story-image"},null,8,ae)])):m("",!0),s.audio?(l(),i("audio",ne,[r("source",{src:s.audio,type:"audio/mp3"},null,8,le)])):m("",!0),r("div",ie,[(l(!0),i(h,null,S(C(s.text),(o,u)=>(l(),i("p",{key:u},[(l(!0),i(h,null,S(o,(a,d)=>(l(),i(h,{key:d},[a.type==="gap"?V((l(),i("input",{key:0,type:"text",class:D(["story-input",[F(t,a.gapIndex,a.correctAnswer),{"input-small":a.gapLength===1,"input-medium":a.gapLength===2,"input-large":a.gapLength===3,"input-full":a.gapLength>=4}]]),"onUpdate:modelValue":w=>v.value[t][a.gapIndex]=w,onKeyup:U(w=>E(t,a.gapIndex),["enter"]),"data-story":t,"data-gap":a.gapIndex,ref_for:!0,ref_key:"inputFields",ref:A},null,42,ue)),[[G,v.value[t][a.gapIndex]]]):(l(),i(h,{key:1},[M(p(a.text),1)],64))],64))),128))]))),128))]),b.value===t?(l(),i("div",ce,[r("p",null,p(s.hintsOrFeedback),1)])):m("",!0),r("div",de,[r("div",pe,[s.hintsOrFeedback?(l(),i("button",{key:0,class:"toggle-script-btn",onClick:o=>B(t)},p(b.value===t?"Hide hints":"Show hints"),9,ve)):m("",!0),r("div",{class:D(["score-display",[{"score-visible":_.value[t]},_.value[t]?x(y.value[t]).class:""]])},p(_.value[t]?`${y.value[t]}% (${x(y.value[t]).letter})`:""),3),r("button",{class:"check-button",onClick:o=>T(t)}," Check ",8,fe)]),r("div",ge,[r("button",{class:"nav-button prev-button",onClick:W,disabled:f.value===0}," \u2190 ",8,_e),r("button",{class:"nav-button next-button",onClick:I,disabled:f.value===c.value.listOfStories.length-1}," \u2192 ",8,he)])])],4))),128))])):(l(),i("div",me," Loading stories... "))}};var Ce=R(ye,[["__scopeId","data-v-6d20d7b2"]]);export{Ce as default};
