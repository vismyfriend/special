import{S as m}from"./sortable.esm.65a421f9.js";import{u as g,o as c,f as d,h as o,t as l,F as S,q as f,n as u}from"./index.b9c5d06d.js";import{s as p}from"./short-sentences-word-order.5c95bdb2.js";import{_ as x}from"./plugin-vue_export-helper.21dcd24c.js";const _={name:"GameDragAndDropSortable",setup(){return{route:g()}},data(){return{sortable:null,draggedWord:null,draggedIndex:null,currentSentenceIndex:0,currentGameData:[],sentences:[],currentWords:[],originalOrder:[],completedSentences:new Set,remainingSentences:[],gamePhase:"first-round"}},computed:{isCurrentSentenceCompleted(){const e=this.currentWords.map(n=>n.word).join(" "),t=this.originalOrder.map(n=>n.word).join(" ");return e===t},buttonText(){return this.gamePhase==="completed"?"\u{1F389} \u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044C \u0438\u0433\u0440\u0443":this.isCurrentSentenceCompleted?"\u{1F504} \u0421\u043B\u0435\u0434\u0443\u044E\u0449\u0435\u0435":"\u23ED\uFE0F \u041F\u0440\u043E\u043F\u0443\u0441\u0442\u0438\u0442\u044C \u043F\u043E\u043A\u0430 \u0447\u0442\u043E"},buttonClass(){return this.gamePhase==="completed"?"finish":this.isCurrentSentenceCompleted?"next":"skip"},allSentencesCompleted(){return this.completedSentences.size===this.currentGameData.length}},mounted(){this.initializeGame()},methods:{initializeGame(){const e=this.route.params.missionName;this.currentGameData=p[e]||[],this.sentences=this.currentGameData.map(t=>t.eng),this.completedSentences=new Set,this.remainingSentences=[...this.sentences.keys()],this.gamePhase="first-round",this.currentSentenceIndex=0,this.loadSentence()},loadSentence(){var s;let e;if(this.gamePhase==="first-round")e=this.currentSentenceIndex;else if(this.gamePhase==="remaining"){if(this.remainingSentences.length===0||this.currentSentenceIndex>=this.remainingSentences.length){this.prepareRemainingSentences();return}e=this.remainingSentences[this.currentSentenceIndex]}else if(this.gamePhase==="completed"){this.finishGame();return}if(e===void 0||e>=this.sentences.length){console.error("Invalid sentence index:",e),this.prepareRemainingSentences();return}const t=(s=this.sentences[e])==null?void 0:s.trim();if(!t){console.error("No text found for sentence index:",e),this.prepareRemainingSentences();return}const n=this.splitSentence(t);if(this.originalOrder=n.map(r=>({id:this.uuid(),word:r})),this.currentWords=[...this.originalOrder].sort(()=>Math.random()-.5),this.currentWords[0].word===this.originalOrder[0].word){const r=this.currentWords.shift();this.currentWords.push(r)}this.$nextTick(()=>this.initializeSortable())},splitSentence(e){const t=[];let n="";for(let s=0;s<e.length;s++){const r=e[s];r===" "?n&&(t.push(n),n=""):/[.,!?;:]/.test(r)?(n+=r,t.push(n),n=""):n+=r}return n&&t.push(n),t},initializeSortable(){this.sortable&&this.sortable.destroy(),this.sortable=new m(this.$refs.container,{animation:180,ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",forceFallback:!0,fallbackOnBody:!0,fallbackTolerance:5,fallbackOffset:{x:0,y:-8},delay:0,delayOnTouchOnly:!1,onStart:e=>{this.draggedIndex=e.oldIndex,this.draggedWord=this.currentWords[e.oldIndex].word},onEnd:e=>{const{oldIndex:t,newIndex:n}=e;if(t===n){this.draggedIndex=null;return}const s=this.currentWords.splice(t,1)[0];this.currentWords.splice(n,0,s),this.draggedIndex=null}})},getWordStatus(e){if(e===0&&this.currentWords[e].word!==this.originalOrder[e].word)return"not-checked";for(let t=0;t<=e;t++)if(this.currentWords[t].word!==this.originalOrder[t].word)return t===e?"incorrect":"not-checked";return"correct"},handleControlButton(){if(this.gamePhase==="completed"){this.finishGame();return}if(this.isCurrentSentenceCompleted){let e;this.gamePhase==="first-round"?e=this.currentSentenceIndex:e=this.remainingSentences[this.currentSentenceIndex],this.completedSentences.add(e)}this.nextSentence()},nextSentence(){if(this.gamePhase==="first-round"){if(this.currentSentenceIndex++,this.currentSentenceIndex>=this.sentences.length){this.prepareRemainingSentences();return}}else this.gamePhase==="remaining"&&(this.currentSentenceIndex++,this.currentSentenceIndex>=this.remainingSentences.length&&(this.allSentencesCompleted?this.gamePhase="completed":this.currentSentenceIndex=0));this.loadSentence()},prepareRemainingSentences(){this.remainingSentences=[];for(let e=0;e<this.sentences.length;e++)this.completedSentences.has(e)||this.remainingSentences.push(e);this.remainingSentences.length===0?(this.gamePhase="completed",this.finishGame()):(this.gamePhase="remaining",this.currentSentenceIndex=0,this.loadSentence())},finishGame(){console.log("\u{1F389} \u0418\u0433\u0440\u0430 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0430! \u0412\u0441\u0435 \u043F\u0440\u0435\u0434\u043B\u043E\u0436\u0435\u043D\u0438\u044F \u0441\u043E\u0441\u0442\u0430\u0432\u043B\u0435\u043D\u044B \u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u043E!"),setTimeout(()=>{},100),this.initializeGame()},uuid(){return Math.random().toString(36).substring(2,10)+Date.now().toString(36)}},beforeUnmount(){this.sortable&&this.sortable.destroy()}},I={class:"drag-game"},b={class:"game-header"},w={class:"progress-info"},W={ref:"container",class:"sentence-container"},C={key:0,class:"drag-emoji"},k={key:1,class:"word-text"},y={class:"game-controls"};function G(e,t,n,s,r,i){return c(),d("div",I,[o("div",b,[t[1]||(t[1]=o("h2",null,"\u{1F9E9} \u041F\u0435\u0440\u0435\u0442\u044F\u043D\u0438 \u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u044B\u0439 \u0441\u043B\u043E\u0432\u0430 \u043F\u043E\u0440\u044F\u0434\u043E\u043A \u0432",-1)),o("div",w,l(r.completedSentences.size)+" / "+l(r.currentGameData.length),1)]),o("div",W,[(c(!0),d(S,null,f(r.currentWords,(h,a)=>(c(),d("div",{key:h.id,class:"word-item"},[o("div",{class:u(["word",{"dragging-placeholder":r.draggedIndex===a,"correct-position":i.getWordStatus(a)==="correct","incorrect-position":i.getWordStatus(a)==="incorrect","not-checked":i.getWordStatus(a)==="not-checked"}])},[r.draggedIndex===a?(c(),d("span",C,"\u{1F447}")):(c(),d("span",k,l(h.word),1))],2)]))),128))],512),o("div",y,[o("button",{onClick:t[0]||(t[0]=(...h)=>i.handleControlButton&&i.handleControlButton(...h)),class:u(["control-button",i.buttonClass])},l(i.buttonText),3)])])}var z=x(_,[["render",G],["__scopeId","data-v-60cc40c9"]]);export{z as default};
