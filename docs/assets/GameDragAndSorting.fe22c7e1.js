import{S as f}from"./sortable.esm.65a421f9.js";import{u as C,p,o as u,f as h,h as o,t as l,F as m,q as g,s as S,n as d}from"./index.74705596.js";import{s as k}from"./sortingWordsData.4932cbf4.js";import{u as _}from"./example-store.6ec008e3.js";import{_ as b}from"./plugin-vue_export-helper.21dcd24c.js";const y={name:"GameDragAndSorting",setup(){const t=C(),s=p(),e=_();return{route:t,router:s,gameStore:e}},data(){return{sortableInstances:[],currentGameData:{title:"",instructions:"",columns:[],items:[]},currentWords:[],columnAssignments:{},completedItems:new Set,columnRefs:{},startTime:null,mistakes:0,wordStatus:{},checkTimer:null,isDragging:!1,countedMistakes:new Set,hintsHidden:!1,temporaryHints:new Set}},computed:{availableWords(){return this.currentWords.filter(t=>!this.columnAssignments[t.id])},duplicateWordsInColumns(){const t=new Set;return this.currentGameData.columns.forEach(s=>{const e=this.getItemsInColumn(s.id),r={};e.forEach(i=>{r[i.eng]||(r[i.eng]=[]),r[i.eng].push(i.id)}),Object.values(r).forEach(i=>{i.length>1&&i.forEach(n=>t.add(n))})}),t}},mounted(){this.initializeGame()},methods:{initializeGame(){const t=this.route.params.missionName||"fruitsVegetables";this.currentGameData=k[t]||k.fruitsVegetables,this.currentWords=this.shuffleArray([...this.currentGameData.items]),this.columnAssignments={},this.completedItems=new Set,this.columnRefs={},this.wordStatus={},this.startTime=Date.now(),this.mistakes=0,this.isDragging=!1,this.countedMistakes=new Set,this.hintsHidden=!0,this.temporaryHints=new Set,this.hintTimers={},this.checkTimer&&clearInterval(this.checkTimer),this.$nextTick(()=>{this.initializeSortable(),this.startPeriodicCheck()})},showHintTemporarily(t){this.hintsHidden&&(this.hintTimers[t]&&clearTimeout(this.hintTimers[t]),this.temporaryHints.add(t),this.hintTimers[t]=setTimeout(()=>{this.temporaryHints.delete(t),delete this.hintTimers[t]},5e3))},shuffleArray(t){const s=[...t];for(let e=s.length-1;e>0;e--){const r=Math.floor(Math.random()*(e+1));[s[e],s[r]]=[s[r],s[e]]}return s},getHintClass(t){return this.columnAssignments[t]?"":this.hintsHidden&&!this.temporaryHints.has(t)?"blurred":""},initializeSortable(){this.sortableInstances.forEach(s=>s.destroy()),this.sortableInstances=[];const t={group:{name:"words",pull:!0,put:!0},animation:180,ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",forceFallback:!0,fallbackOnBody:!0,fallbackTolerance:5,fallbackOffset:{x:0,y:-8},delay:0,delayOnTouchOnly:!1,onStart:()=>{this.isDragging=!0},onEnd:()=>{this.isDragging=!1}};if(this.$refs.wordsContainer){const s=new f(this.$refs.wordsContainer,{...t,sort:!1,onAdd:e=>{const r=e.item.getAttribute("data-id");delete this.columnAssignments[r],this.wordStatus[r]=null,this.countedMistakes.delete(r)}});this.sortableInstances.push(s)}this.currentGameData.columns.forEach(s=>{const e=this.columnRefs[s.id];if(e){const r=new f(e,{...t,onAdd:i=>{const n=i.item.getAttribute("data-id");this.columnAssignments[n]=s.id,this.$nextTick(()=>{this.updateAllColumnsHeight()})}});this.sortableInstances.push(r)}})},toggleHints(){this.hintsHidden=!this.hintsHidden},startPeriodicCheck(){this.checkTimer=setInterval(()=>{this.isDragging||this.checkWordStatuses()},500)},updateAllColumnsHeight(){const t=document.querySelectorAll(".column-content");let s=180;t.forEach(e=>{const r=e.scrollHeight;r>s&&(s=r)}),t.forEach(e=>{e.style.minHeight=`${s}px`})},checkWordStatuses(){this.currentWords.forEach(t=>{if(this.columnAssignments[t.id]){const s=this.columnAssignments[t.id],e=Array.isArray(t.correctColumn)?t.correctColumn.includes(s):t.correctColumn===s,i=this.duplicateWordsInColumns.has(t.id)?"incorrect":e?"correct":"incorrect";(this.wordStatus[t.id]===null||i!==this.wordStatus[t.id])&&(this.wordStatus[t.id]=i,i==="incorrect"&&!this.countedMistakes.has(t.id)&&(this.mistakes++,this.countedMistakes.add(t.id)),i==="correct"&&this.countedMistakes.has(t.id)&&this.countedMistakes.delete(t.id))}else this.wordStatus[t.id]=null,this.countedMistakes.delete(t.id)})},getWordCardClass(t){const s=this.wordStatus[t];return this.duplicateWordsInColumns.has(t)?"word-duplicate":s==="correct"?"word-correct":s==="incorrect"?"word-incorrect":""},getItemsInColumn(t){return this.currentWords.filter(s=>this.columnAssignments[s.id]===t)},checkAnswers(){this.checkTimer&&clearInterval(this.checkTimer);let t=0;this.currentWords.forEach(s=>{const e=this.columnAssignments[s.id];e&&((Array.isArray(s.correctColumn)?s.correctColumn.includes(e):s.correctColumn===e)?(this.completedItems.add(s.id),this.wordStatus[s.id]="correct"):(t++,this.wordStatus[s.id]="incorrect"))}),this.mistakes=t,this.finishGame()},finishGame(){const t=Date.now()-this.startTime;this.gameStore.setLastGameResults(t,this.mistakes),this.gameStore.setGameName("WordSorting"),this.gameStore.setWordSet(this.route.params.missionName),this.router.push({path:"/leader-board/",query:{missionName:this.route.params.missionName}})},resetGame(){this.initializeGame()}},beforeUnmount(){this.sortableInstances.forEach(t=>t.destroy()),this.checkTimer&&clearInterval(this.checkTimer)}},v={class:"drag-sort-game"},A={class:"game-header"},H={class:"instructions"},T={class:"columns-container"},D={class:"column-header"},G=["data-id","onClick"],W={class:"word-eng"},I={ref:"wordsContainer",class:"words-container"},w=["data-id","onClick"],E={class:"word-eng"},M={class:"game-controls"};function x(t,s,e,r,i,n){return u(),h("div",v,[o("div",A,[o("h2",null,l(i.currentGameData.title),1)]),o("div",H,[o("p",null,l(i.currentGameData.instructions),1)]),o("div",T,[(u(!0),h(m,null,g(i.currentGameData.columns,a=>(u(),h("div",{key:a.id,class:"column"},[o("div",D,[s[2]||(s[2]=o("span",{class:"column-icon"},"\u{1F4C1}",-1)),S(" "+l(a.title),1)]),o("div",{ref_for:!0,ref:c=>{i.columnRefs[a.id]=c},class:"column-content"},[(u(!0),h(m,null,g(n.getItemsInColumn(a.id),c=>(u(),h("div",{key:c.id,class:d(["word-card in-column",n.getWordCardClass(c.id)]),"data-id":c.id,onClick:N=>n.showHintTemporarily(c.id)},[o("div",W,l(c.eng),1),o("div",{class:d(["word-ru",n.getHintClass(c.id)])},l(c.ru),3)],10,G))),128))],512)]))),128))]),o("div",I,[(u(!0),h(m,null,g(n.availableWords,a=>(u(),h("div",{key:a.id,class:d(["word-card",n.getWordCardClass(a.id)]),"data-id":a.id,onClick:c=>n.showHintTemporarily(a.id)},[o("div",E,l(a.eng),1),o("div",{class:d(["word-ru",n.getHintClass(a.id)])},l(a.ru),3)],10,w))),128))],512),o("div",M,[o("button",{onClick:s[0]||(s[0]=(...a)=>n.checkAnswers&&n.checkAnswers(...a)),class:"control-button check"}," \u2705 \u043F\u043E\u0434\u0435\u043B\u0438\u0442\u044C\u0441\u044F "),o("button",{onClick:s[1]||(s[1]=(...a)=>n.toggleHints&&n.toggleHints(...a)),class:"control-button hints"},l(i.hintsHidden?"\u{1F441}\uFE0F \u041F\u043E\u043A\u0430\u0437\u0430\u0442\u044C \u043F\u043E\u0434\u0441\u043A\u0430\u0437\u043A\u0438":"\u{1F648} \u0421\u043A\u0440\u044B\u0442\u044C \u043F\u043E\u0434\u0441\u043A\u0430\u0437\u043A\u0438"),1)])])}var q=b(y,[["render",x],["__scopeId","data-v-64c6e2e7"]]);export{q as default};
