import{u as P,b as g,d as z,o as l,f as i,h as a,t as p,F as _,q as S,s as K,l as m,j as V,m as G,n as D,C as U,z as M,E as O}from"./index.99f3f480.js";import{s as q}from"./storiesData.b350cfa0.js";import{_ as R}from"./plugin-vue_export-helper.21dcd24c.js";const j={key:0,class:"stories-container"},H={class:"stories-header"},J={class:"header-bottom"},Q={class:"task-counter"},X={key:0,class:"useful-words-container"},Y={class:"useful-words"},Z={class:"useful-words-content"},ee={class:"english-word"},te={class:"translation"},se={key:0,class:"comma"},oe={class:"story-title"},ae={key:1,class:"story-image-container"},ne=["src","alt"],re={key:2,controls:"",class:"audio-player",controlsList:"nodownload",oncontextmenu:"return false;"},le=["src"],ie={class:"story-text"},ue=["onUpdate:modelValue","onKeyup","data-story","data-gap"],ce={key:3,class:"text-script-content"},de={class:"story-footer"},pe={class:"story-controls"},ve=["onClick"],fe=["onClick"],ge={class:"story-navigation"},he=["disabled"],_e=["disabled"],me={key:1,class:"loading-container"},ye={__name:"GameStoriesAndWords",setup(ke){const N=P(),c=g(null),v=g([]),h=g([]),b=g(null),y=g([]),f=g(0),A=g([]);z(()=>{const e=N.params.missionName;c.value=q[e]||null,c.value&&(v.value=c.value.listOfStories.map(r=>{const s=C(r.text).flat().filter(t=>t.type==="gap").length;return Array(s).fill("")}),h.value=c.value.listOfStories.map(()=>!1),y.value=c.value.listOfStories.map(()=>null)),B()});const k=e=>!e||typeof e!="string"?"":e.toLowerCase().replace(/\s+/g," ").trim().replace(/[.,!?;:…–—]+$/g,"").replace(/[.,!?;:…–—]/g," ").replace(/\s+/g," ").replace(/^-$/,""),C=e=>{if(!e)return[];const r=e.split(`
`).filter(o=>o.trim()!=="");let s=0;const t=[];for(const o of r){const u=[];let n=0,d;const w=/(_+) \((.+?)\)/g;for(;(d=w.exec(o))!==null;)d.index>n&&u.push({type:"text",text:o.substring(n,d.index)}),u.push({type:"gap",gapIndex:s++,gapLength:d[1].length,correctAnswer:d[2]}),n=d.index+d[0].length;n<o.length&&u.push({type:"text",text:o.substring(n)}),u.length>0&&t.push(u)}return t},T=e=>{const r=c.value.listOfStories[e];h.value[e]=!0;let s=0;const t=C(r.text).flat().filter(o=>o.type==="gap");t.forEach((o,u)=>{const n=k(v.value[e][u]),d=k(o.correctAnswer);o.correctAnswer.trim()==="-"?(n===""||k(v.value[e][u])==="-")&&s++:(o.correctAnswer.toLowerCase()==="anyanswerisok"||n===d)&&s++}),y.value[e]=Math.round(s/t.length*100)},E=(e,r,s)=>{if(!h.value[e])return"";const t=k(v.value[e][r]),o=k(s);return s.trim()==="-"?t===""||v.value[e][r]==="-"?"story-input-correct":"story-input-incorrect":s.toLowerCase()==="anyanswerisok"?"story-input-any":t===o?"story-input-correct":"story-input-incorrect"},F=()=>{f.value<c.value.listOfStories.length-1&&(f.value++,window.scrollTo({top:0,behavior:"smooth"}))},I=()=>{f.value>0&&(f.value--,window.scrollTo({top:0,behavior:"smooth"}))},x=e=>e===100?{letter:"A+",class:"grade-Aplus"}:e>=85?{letter:"A",class:"grade-A"}:e>=75?{letter:"B+",class:"grade-Bplus"}:e>=60?{letter:"B-",class:"grade-Bminus"}:e>=40?{letter:"C",class:"grade-C"}:e>=20?{letter:"D",class:"grade-D"}:e>=10?{letter:"E",class:"grade-E"}:{letter:"F",class:"grade-F"},W=e=>{b.value=b.value===e?null:e},L=e=>e?e.split(",").map(r=>{const[s,t]=r.split("-").map(o=>o.trim());return{english:s,russian:t}}):[],$=(e,r)=>{const s=r+1;s<v.value[e].length?O(()=>{const t=A.value.find(o=>Number(o.dataset.story)===e&&Number(o.dataset.gap)===s);t&&(t.focus(),t.select())}):O(()=>{const t=document.querySelector('.story-container[style*="block"] .check-button');t==null||t.focus()})},B=()=>{document.addEventListener("contextmenu",e=>{if(e.target.classList.contains("audio-player"))return e.preventDefault(),!1}),document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="s"&&e.preventDefault()})};return(e,r)=>c.value?(l(),i("div",j,[a("div",H,[a("h2",null,p(c.value.mainDescription),1),a("div",J,[r[0]||(r[0]=a("p",{class:"main-description"},"for S.P.E.C.i.A.L. agents",-1)),a("div",Q,p(f.value+1)+"/"+p(c.value.listOfStories.length),1)])]),(l(!0),i(_,null,S(c.value.listOfStories,(s,t)=>(l(),i("div",{key:t,class:"story-container",style:K({display:t===f.value?"block":"none"})},[s.usefulWords?(l(),i("div",X,[a("div",Y,[r[2]||(r[2]=a("span",{class:"useful-words-title"},"Useful words:",-1)),a("div",Z,[(l(!0),i(_,null,S(L(s.usefulWords),(o,u)=>(l(),i("div",{key:u,class:"word-pair"},[a("span",ee,p(o.english),1),r[1]||(r[1]=a("span",{class:"separator"},"-",-1)),a("span",te,p(o.russian),1),u<L(s.usefulWords).length-1?(l(),i("span",se,",")):m("",!0)]))),128))])])])):m("",!0),a("h3",oe,p(s.storyTitle),1),s.taskPicture?(l(),i("div",ae,[a("img",{src:s.taskPicture,alt:"Image for story "+(t+1),class:"story-image"},null,8,ne)])):m("",!0),s.audio?(l(),i("audio",re,[a("source",{src:s.audio,type:"audio/mp3"},null,8,le)])):m("",!0),a("div",ie,[(l(!0),i(_,null,S(C(s.text),(o,u)=>(l(),i("p",{key:u},[(l(!0),i(_,null,S(o,(n,d)=>(l(),i(_,{key:d},[n.type==="gap"?V((l(),i("input",{key:0,type:"text",class:D(["story-input",[E(t,n.gapIndex,n.correctAnswer),{"input-small":n.gapLength===1,"input-medium":n.gapLength===2,"input-large":n.gapLength===3,"input-full":n.gapLength>=4}]]),"onUpdate:modelValue":w=>v.value[t][n.gapIndex]=w,onKeyup:U(w=>$(t,n.gapIndex),["enter"]),"data-story":t,"data-gap":n.gapIndex,ref_for:!0,ref_key:"inputFields",ref:A},null,42,ue)),[[G,v.value[t][n.gapIndex]]]):(l(),i(_,{key:1},[M(p(n.text),1)],64))],64))),128))]))),128))]),b.value===t?(l(),i("div",ce,[a("p",null,p(s.hintsOrFeedback),1)])):m("",!0),a("div",de,[a("div",pe,[s.hintsOrFeedback?(l(),i("button",{key:0,class:"toggle-script-btn",onClick:o=>W(t)},p(b.value===t?"Hide hints":"Show hints"),9,ve)):m("",!0),a("div",{class:D(["score-display",[{"score-visible":h.value[t]},h.value[t]?x(y.value[t]).class:""]])},p(h.value[t]?`${y.value[t]}% (${x(y.value[t]).letter})`:""),3),a("button",{class:"check-button",onClick:o=>T(t)}," Check ",8,fe)]),a("div",ge,[a("button",{class:"nav-button prev-button",onClick:I,disabled:f.value===0}," \u2190 ",8,he),a("button",{class:"nav-button next-button",onClick:F,disabled:f.value===c.value.listOfStories.length-1}," \u2192 ",8,_e)])])],4))),128))])):(l(),i("div",me," Loading stories... "))}};var Ce=R(ye,[["__scopeId","data-v-6d20d7b2"]]);export{Ce as default};
