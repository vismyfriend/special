import{u as K,r as _,o as V,b as a,c as r,e as n,t as d,F as h,q as w,s as z,j as m,w as G,k as P,n as I,A as U,y as M,B as D}from"./index.e0366d50.js";import{s as q}from"./storiesData.2d2da84a.js";import{_ as R}from"./plugin-vue_export-helper.21dcd24c.js";const j={key:0,class:"stories-container"},H={class:"stories-header"},J={class:"header-bottom"},Q={class:"task-counter"},X={key:0,class:"useful-words-container"},Y={class:"useful-words"},Z={class:"useful-words-content"},tt={class:"english-word"},et={class:"translation"},st={key:0,class:"comma"},ot={class:"story-title"},nt={key:1,class:"story-image-container"},at=["src","alt"],rt={key:2,controls:"",class:"audio-player",controlsList:"nodownload",oncontextmenu:"return false;"},lt=["src"],it={class:"story-text"},ut=["onUpdate:modelValue","onKeyup","data-story","data-gap"],ct={key:3,class:"text-script-content"},dt={class:"story-footer"},pt={class:"story-controls"},vt=["onClick"],_t=["onClick"],ft={class:"story-navigation"},gt=["disabled"],ht=["disabled"],mt={key:1,class:"loading-container"},yt={__name:"GameStoriesAndWords",setup(kt){const O=K(),u=_(null),f=_([]),g=_([]),k=_(null),y=_([]),p=_(0),x=_([]);V(()=>{const t=O.params.missionName;u.value=q[t]||null,u.value&&(f.value=u.value.listOfStories.map(l=>{const s=S(l.text).flat().filter(e=>e.type==="gap").length;return Array(s).fill("")}),g.value=u.value.listOfStories.map(()=>!1),y.value=u.value.listOfStories.map(()=>null)),$()});const b=t=>!t||typeof t!="string"?"":t.toLowerCase().replace(/\s+/g," ").trim().replace(/[.,!?;:…–—]+$/g,"").replace(/[.,!?;:…–—]/g," ").replace(/\s+/g," "),S=t=>t?t.split(`
`).filter(s=>s.trim()!=="").map(s=>{const e=[];let o=0,v=0;const i=/(_+) \((.+?)\)/g;let c;for(;(c=i.exec(s))!==null;)c.index>o&&e.push({type:"text",text:s.substring(o,c.index)}),e.push({type:"gap",gapIndex:v++,gapLength:c[1].length,correctAnswer:c[2]}),o=c.index+c[0].length;return o<s.length&&e.push({type:"text",text:s.substring(o)}),e}):[],F=t=>{const l=u.value.listOfStories[t];g.value[t]=!0;let s=0;const e=S(l.text).flat().filter(o=>o.type==="gap");e.forEach((o,v)=>{const i=b(f.value[t][v]),c=b(o.correctAnswer);(o.correctAnswer.toLowerCase()==="anyanswerisok"||i===c)&&s++}),y.value[t]=Math.round(s/e.length*100)},N=(t,l,s)=>{if(!g.value[t])return"";const e=b(f.value[t][l]),o=b(s);return s.toLowerCase()==="anyanswerisok"?"story-input-any":e===o?"story-input-correct":"story-input-incorrect"},T=()=>{p.value<u.value.listOfStories.length-1&&(p.value++,window.scrollTo({top:0,behavior:"smooth"}))},W=()=>{p.value>0&&(p.value--,window.scrollTo({top:0,behavior:"smooth"}))},A=t=>t===100?{letter:"A+",class:"grade-Aplus"}:t>=85?{letter:"A",class:"grade-A"}:t>=75?{letter:"B+",class:"grade-Bplus"}:t>=60?{letter:"B-",class:"grade-Bminus"}:t>=40?{letter:"C",class:"grade-C"}:t>=20?{letter:"D",class:"grade-D"}:t>=10?{letter:"E",class:"grade-E"}:{letter:"F",class:"grade-F"},B=t=>{k.value=k.value===t?null:t},C=t=>t?t.split(",").map(l=>{const[s,e]=l.split("-").map(o=>o.trim());return{english:s,russian:e}}):[],E=(t,l)=>{const s=l+1;s<f.value[t].length?D(()=>{const e=x.value.find(o=>Number(o.dataset.story)===t&&Number(o.dataset.gap)===s);e&&(e.focus(),e.select())}):D(()=>{const e=document.querySelector('.story-container[style*="block"] .check-button');e==null||e.focus()})},$=()=>{document.addEventListener("contextmenu",t=>{if(t.target.classList.contains("audio-player"))return t.preventDefault(),!1}),document.addEventListener("keydown",t=>{(t.ctrlKey||t.metaKey)&&t.key==="s"&&t.preventDefault()})};return(t,l)=>u.value?(a(),r("div",j,[n("div",H,[n("h2",null,d(u.value.mainDescription),1),n("div",J,[l[0]||(l[0]=n("p",{class:"main-description"},"Fill in the gaps in these mysterious stories",-1)),n("div",Q,d(p.value+1)+"/"+d(u.value.listOfStories.length),1)])]),(a(!0),r(h,null,w(u.value.listOfStories,(s,e)=>(a(),r("div",{key:e,class:"story-container",style:z({display:e===p.value?"block":"none"})},[s.usefulWords?(a(),r("div",X,[n("div",Y,[l[2]||(l[2]=n("span",{class:"useful-words-title"},"Useful words:",-1)),n("div",Z,[(a(!0),r(h,null,w(C(s.usefulWords),(o,v)=>(a(),r("div",{key:v,class:"word-pair"},[n("span",tt,d(o.english),1),l[1]||(l[1]=n("span",{class:"separator"},"-",-1)),n("span",et,d(o.russian),1),v<C(s.usefulWords).length-1?(a(),r("span",st,",")):m("",!0)]))),128))])])])):m("",!0),n("h3",ot,d(s.storyTitle),1),s.taskPicture?(a(),r("div",nt,[n("img",{src:s.taskPicture,alt:"Image for story "+(e+1),class:"story-image"},null,8,at)])):m("",!0),s.audio?(a(),r("audio",rt,[n("source",{src:s.audio,type:"audio/mp3"},null,8,lt)])):m("",!0),n("div",it,[(a(!0),r(h,null,w(S(s.text),(o,v)=>(a(),r("p",{key:v},[(a(!0),r(h,null,w(o,(i,c)=>(a(),r(h,{key:c},[i.type==="gap"?G((a(),r("input",{key:0,type:"text",class:I(["story-input",[N(e,i.gapIndex,i.correctAnswer),{"input-small":i.gapLength===1,"input-medium":i.gapLength===2,"input-large":i.gapLength===3,"input-full":i.gapLength>=4}]]),"onUpdate:modelValue":L=>f.value[e][i.gapIndex]=L,onKeyup:U(L=>E(e,i.gapIndex),["enter"]),"data-story":e,"data-gap":i.gapIndex,ref_for:!0,ref_key:"inputFields",ref:x},null,42,ut)),[[P,f.value[e][i.gapIndex]]]):(a(),r(h,{key:1},[M(d(i.text),1)],64))],64))),128))]))),128))]),k.value===e?(a(),r("div",ct,[n("p",null,d(s.hintsOrFeedback),1)])):m("",!0),n("div",dt,[n("div",pt,[s.hintsOrFeedback?(a(),r("button",{key:0,class:"toggle-script-btn",onClick:o=>B(e)},d(k.value===e?"Hide hints":"Show hints"),9,vt)):m("",!0),n("div",{class:I(["score-display",[{"score-visible":g.value[e]},g.value[e]?A(y.value[e]).class:""]])},d(g.value[e]?`${y.value[e]}% (${A(y.value[e]).letter})`:""),3),n("button",{class:"check-button",onClick:o=>F(e)}," Check ",8,_t)]),n("div",ft,[n("button",{class:"nav-button prev-button",onClick:W,disabled:p.value===0}," \u2190 ",8,gt),n("button",{class:"nav-button next-button",onClick:T,disabled:p.value===u.value.listOfStories.length-1}," \u2192 ",8,ht)])])],4))),128))])):(a(),r("div",mt," Loading stories... "))}};var xt=R(yt,[["__scopeId","data-v-7242db78"]]);export{xt as default};
