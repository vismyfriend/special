import{S as m}from"./sortable.esm.65a421f9.js";import{u as g,p as S,o,f as c,h as a,F as f,q as p,t as l,n as u,l as x}from"./index.fe43eb95.js";import{s as _}from"./short-sentences-word-order.64e1de19.js";import{u as C}from"./example-store.af470954.js";import{_ as b}from"./plugin-vue_export-helper.21dcd24c.js";const I={name:"GameDragAndDropSortable",setup(){const e=g(),t=S(),n=C();return{route:e,router:t,gameStore:n}},data(){return{sortable:null,draggedWord:null,draggedIndex:null,currentSentenceIndex:0,currentGameData:[],sentences:[],shuffledSentences:[],currentWords:[],originalOrder:[],completedSentences:new Set,remainingSentences:[],gamePhase:"first-round",startTime:null,mistakes:0,currentTranslation:"",totalAttempts:0}},computed:{isCurrentSentenceCompleted(){const e=this.currentWords.map(n=>n.word).join(" "),t=this.originalOrder.map(n=>n.word).join(" ");return e===t},displayTranslation(){return this.isCurrentSentenceCompleted?"\u0421\u043A\u0430\u0436\u0438 \u044D\u0442\u043E \u0431\u0435\u0433\u043B\u043E \u043F\u043E-\u0430\u043D\u0433\u043B\u0438\u0439\u0441\u043A\u0438 \u0432\u0441\u043B\u0443\u0445, \u0442\u0440\u0435\u043D\u0438\u0440\u0443\u0439 \u043F\u0440\u043E\u0438\u0437\u043D\u043E\u0448\u0435\u043D\u0438\u0435 \u{1F3A4}":this.currentTranslation||"\u0421\u043A\u0430\u0436\u0438 \u044D\u0442\u043E \u0431\u0435\u0433\u043B\u043E \u043F\u043E-\u0430\u043D\u0433\u043B\u0438\u0439\u0441\u043A\u0438 \u0432\u0441\u043B\u0443\u0445, \u0442\u0440\u0435\u043D\u0438\u0440\u0443\u0439 \u043F\u0440\u043E\u0438\u0437\u043D\u043E\u0448\u0435\u043D\u0438\u0435 \u{1F3A4}"},shouldShowTranslation(){return this.currentTranslation||this.isCurrentSentenceCompleted},buttonText(){return this.gamePhase==="completed"?"\u{1F389} \u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044C \u0438\u0433\u0440\u0443":this.isCurrentSentenceCompleted?"\u{1F504} \u0421\u043B\u0435\u0434\u0443\u044E\u0449\u0435\u0435":"\u23ED\uFE0F \u043F\u0440\u043E\u043F\u0443\u0441\u0442\u0438\u0442\u044C \u043F\u043E\u043A\u0430"},buttonClass(){return this.gamePhase==="completed"?"finish":this.isCurrentSentenceCompleted?"next":"skip"},allSentencesCompleted(){return this.completedSentences.size===this.currentGameData.length},isSpeakPrompt(){return this.isCurrentSentenceCompleted||!this.currentTranslation}},mounted(){this.initializeGame()},methods:{initializeGame(){const e=this.route.params.missionName;this.currentGameData=_[e]||[],this.sentences=this.currentGameData,this.shuffledSentences=this.shuffleArray([...this.sentences]),this.completedSentences=new Set,this.remainingSentences=[...this.shuffledSentences.keys()],this.gamePhase="first-round",this.currentSentenceIndex=0,this.startTime=Date.now(),this.mistakes=0,this.totalAttempts=0,this.loadSentence()},shuffleArray(e){const t=[...e];for(let n=t.length-1;n>0;n--){const r=Math.floor(Math.random()*(n+1));[t[n],t[r]]=[t[r],t[n]]}return t},loadSentence(){let e;if(this.gamePhase==="first-round")e=this.currentSentenceIndex;else if(this.gamePhase==="remaining"){if(this.remainingSentences.length===0||this.currentSentenceIndex>=this.remainingSentences.length){this.prepareRemainingSentences();return}e=this.remainingSentences[this.currentSentenceIndex]}else if(this.gamePhase==="completed"){this.finishGame();return}if(e===void 0||e>=this.shuffledSentences.length){console.error("Invalid sentence index:",e),this.prepareRemainingSentences();return}const t=this.shuffledSentences[e];if(!t||!t.eng){console.error("No sentence object found for index:",e),this.prepareRemainingSentences();return}const n=t.eng.trim();this.currentTranslation=t.ru||"";const r=this.splitSentence(n);if(this.originalOrder=r.map(s=>({id:this.uuid(),word:s})),this.currentWords=[...this.originalOrder].sort(()=>Math.random()-.5),this.currentWords[0].word===this.originalOrder[0].word){const s=this.currentWords.shift();this.currentWords.push(s)}this.$nextTick(()=>this.initializeSortable())},splitSentence(e){const t=[];let n="";for(let r=0;r<e.length;r++){const s=e[r];s===" "?n&&(t.push(n),n=""):/[.,!?;:]/.test(s)?(n+=s,t.push(n),n=""):n+=s}return n&&t.push(n),t},initializeSortable(){this.sortable&&this.sortable.destroy(),this.sortable=new m(this.$refs.container,{animation:180,ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",forceFallback:!0,fallbackOnBody:!0,fallbackTolerance:5,fallbackOffset:{x:0,y:-8},delay:0,delayOnTouchOnly:!1,onStart:e=>{this.draggedIndex=e.oldIndex,this.draggedWord=this.currentWords[e.oldIndex].word},onEnd:e=>{const{oldIndex:t,newIndex:n}=e;if(t===n){this.draggedIndex=null;return}const r=this.currentWords.splice(t,1)[0];this.currentWords.splice(n,0,r),this.draggedIndex=null,this.totalAttempts++}})},getWordStatus(e){if(e===0&&this.currentWords[e].word!==this.originalOrder[e].word)return"not-checked";for(let t=0;t<=e;t++)if(this.currentWords[t].word!==this.originalOrder[t].word)return t===e?"incorrect":"not-checked";return"correct"},handleControlButton(){if(this.gamePhase==="completed"){this.finishGame();return}if(this.isCurrentSentenceCompleted||this.mistakes++,this.isCurrentSentenceCompleted){let e;this.gamePhase==="first-round"?e=this.currentSentenceIndex:e=this.remainingSentences[this.currentSentenceIndex],this.completedSentences.add(e)}this.nextSentence()},nextSentence(){if(this.gamePhase==="first-round"){if(this.currentSentenceIndex++,this.currentSentenceIndex>=this.shuffledSentences.length){this.prepareRemainingSentences();return}}else this.gamePhase==="remaining"&&(this.currentSentenceIndex++,this.currentSentenceIndex>=this.remainingSentences.length&&(this.allSentencesCompleted?this.gamePhase="completed":this.currentSentenceIndex=0));this.loadSentence()},prepareRemainingSentences(){this.remainingSentences=[];for(let e=0;e<this.shuffledSentences.length;e++)this.completedSentences.has(e)||this.remainingSentences.push(e);this.remainingSentences.length===0?(this.gamePhase="completed",this.finishGame()):(this.gamePhase="remaining",this.currentSentenceIndex=0,this.loadSentence())},finishGame(){const e=Date.now()-this.startTime,t={missionName:this.route.params.missionName,gameType:"SentenceOrder",completionTime:e,mistakes:this.mistakes,totalSentences:this.currentGameData.length,completedSentences:this.completedSentences.size,totalAttempts:this.totalAttempts,accuracy:Math.round(this.completedSentences.size/this.currentGameData.length*100),timestamp:new Date().toISOString()};this.gameStore.setLastGameResults(e,this.mistakes),this.gameStore.setGameName("SentenceOrder"),this.gameStore.setWordSet(this.route.params.missionName),console.log("\u{1F389} \u0418\u0433\u0440\u0430 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0430! \u0420\u0435\u0437\u0443\u043B\u044C\u0442\u0430\u0442\u044B:",t),this.router.push({path:"/leader-board/",query:{missionName:this.route.params.missionName}})},uuid(){return Math.random().toString(36).substring(2,10)+Date.now().toString(36)}},beforeUnmount(){this.sortable&&this.sortable.destroy()}},k={class:"drag-game"},w={ref:"container",class:"sentence-container"},y={key:0,class:"drag-emoji"},W={key:1,class:"word-text"},D={key:0,class:"translation-container"},G={class:"game-controls"},T={class:"progress-info"};function O(e,t,n,r,s,i){return o(),c("div",k,[t[1]||(t[1]=a("div",{class:"game-header"},[a("h2",null,"\u{1F9E9} \u041F\u0435\u0440\u0435\u0442\u044F\u043D\u0438 \u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u044B\u0439 \u0441\u043B\u043E\u0432\u0430 \u043F\u043E\u0440\u044F\u0434\u043E\u043A \u0432")],-1)),a("div",w,[(o(!0),c(f,null,p(s.currentWords,(d,h)=>(o(),c("div",{key:d.id,class:"word-item"},[a("div",{class:u(["word",{"dragging-placeholder":s.draggedIndex===h,"correct-position":i.getWordStatus(h)==="correct","incorrect-position":i.getWordStatus(h)==="incorrect","not-checked":i.getWordStatus(h)==="not-checked"}])},[s.draggedIndex===h?(o(),c("span",y,"\u{1F447}")):(o(),c("span",W,l(d.word),1))],2)]))),128))],512),i.shouldShowTranslation?(o(),c("div",D,[a("div",{class:u(["translation-text",{"speak-prompt":i.isSpeakPrompt}])},l(i.displayTranslation),3)])):x("",!0),a("div",G,[a("div",T,l(s.completedSentences.size)+" / "+l(s.currentGameData.length),1),a("button",{onClick:t[0]||(t[0]=(...d)=>i.handleControlButton&&i.handleControlButton(...d)),class:u(["control-button",i.buttonClass])},l(i.buttonText),3)])])}var R=b(I,[["render",O],["__scopeId","data-v-7d9257f4"]]);export{R as default};
